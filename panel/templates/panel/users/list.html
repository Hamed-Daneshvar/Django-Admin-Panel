{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load jformat %}


{% block title %}
مدیریت کاربران
{% endblock title %}

{% block main-inner-content %}
<!-- Page Header -->
<div class="page-header">
	<div>
		<h2 class="main-content-title tx-24 mg-b-5"> کاربران </h2>
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="{% url 'panel:home' %}">خانه</a></li>
			<li class="breadcrumb-item active" aria-current="page">کاربران</li>
		</ol>
	</div>
</div>


<div class="row">
	<div class="col-lg-12">
		<div class="card custom-card">
			<div class="card-body">
				<button class="btn btn-primary mb-3" data-toggle="modal" data-target="#modal-create">ساخت کاربر</button>

				<!-- Create Modal -->
				<div class="modal fade" id="modal-create">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h4 class="modal-title">ساخت کاربر جدید</h4>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<!-- form start -->
								<form  method="POST" action="{% url 'panel:create_user' %}"  enctype="multipart/form-data">
									{% csrf_token %}
									<div class="card-body">
										<div class="form-group">
											<label for="id_full_name">نام</label>
											{% render_field create_user_form.full_name class+="form-control" placeholder="نام کاربر را وارد کنید" required="required" %}
										</div>
										<div class="form-group">
											<label for="id_email">پست الکترونیک</label>
											{% render_field create_user_form.email class+="form-control" placeholder="ایمیل کاربر را وارد کنید" required="required" %}
										</div>
										<div class="form-group">
											<label for="id_password1">کلمه عبور</label>
											{% render_field create_user_form.password1 class+="form-control" placeholder="رمز ورود کاربر را وارد کنید" required="required" %}
										</div>
										<div class="form-group">
											<label for="id_avatar">تصویر پروفایل</label>
											<div class="input-group">
												<div class="custom-file">
													{% render_field create_user_form.avatar class+="custom-file-input" %}
													<label class="custom-file-label" for="id_avatar">Choose file</label>
												</div>
											</div>
										</div>
									</div>
									<!-- /.card-body -->

									<div class="card-footer">
										<button type="submit" class="btn btn-primary">ایجاد</button>
									</div>
								</form>
							</div>
						</div>
						<!-- /.modal-content -->
					</div>
					<!-- /.modal-dialog -->
				</div>

				<table id="table" class="table table-bordered table-striped text-center">
					<thead>
					<tr>
						<th>تصویر کاربر</th>
						<th>نام و نام خانوادگی</th>
						<th>ایمیل</th>
						<th>تاریخ عضویت</th>
						<th>عملیات</th>
					</tr>
					</thead>
					<tbody >
					{% for simple_user in users %}
						<tr>
							<td>
								{% if simple_user.avatar %}
								<img class="rounded-circle" src="{{ simple_user.avatar.url }}" alt="" width="50" height="50">
								{% else %}
								<img class="rounded-circle" src="{% static 'assets/img/users/default_user.png' %}" alt="" width="50" height="50">
								{% endif %}
							</td>
							<td>
								{{ simple_user.full_name }}
							</td>
							<td>{{simple_user.email }}</td>
							<td >
								<button class="btn btn-secondary" data-toggle="tooltip" data-placement="top" title="{{ simple_user.create_at|jformat:'%A، %d %B %Y - %H:%M:%S' }}">
									{{ simple_user.create_at|jformat:"%A، %d %B %Y" }}
								</button>
							</td>
							<td class="text-center">
								<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<i class="fas fa-sliders-h"></i>
								</button>
								<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
									<button type="button" class="btn btn-success dropdown-item" data-toggle="modal" data-target="#modal-edit{{simple_user.id}}" ><i  class="fas fa-user-edit"></i>ویرایش</button>
									<button type="button" class="dropdown-item" data-toggle="modal" data-target="#modal-delete{{simple_user.id}}" ><i style="color:red" class="fas fa-user-minus"></i>حذف</button>
								</div>
							</td>

						</tr>
						<!-- Delete Modal -->
						<div class="modal fade" id="modal-delete{{ simple_user.id }}">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title">حذف کاربر</h4>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<h5>آیا در حذف کاربر  
											{% if simple_user.full_name %}
												"{{ simple_user.full_name }}"
											{% elif simple_user.nick_name %}
												"{{ simple_user.nick_name }}"
											{% else %}
												"{{ simple_user.email }}"
											{% endif %}
											مطمئن هستید؟ </h5>
									</div>
									<div class="modal-footer justify-content-between">
										<button type="button" class="btn btn-secondary" data-dismiss="modal">بستن</button>
										<form action="{% url 'panel:delete_user' simple_user.id %}" method="POST">
											{% csrf_token %}
											<button type="submit" class="btn btn-danger">حذف</button>
										</form>

									</div>
								</div>
								<!-- /.modal-content -->
							</div>
							<!-- /.modal-dialog -->
						</div>
						<!-- /.modal -->

						<!-- Change Modal -->
						<div class="modal fade" id="modal-edit{{simple_user.id}}">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title">ویرایش کاربر</h4>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<!-- form start -->
										<form  method="POST" action="{% url 'panel:update_user' simple_user.id %}"  enctype="multipart/form-data">
											{% csrf_token %}
											{% comment %} <div class="card-body">
												<div class="form-group">
													<label for="id_nick_name">نام نمایشی</label>
													{% render_field update_user_form.nick_name class+="form-control" placeholder="نام  نمایشی کاربر را وارد کنید" %}
												</div>
												<div class="form-group">
													<label for="id_full_name">نام و نام خانوادگی</label>
													{% render_field update_user_form.full_name class+="form-control" placeholder="نام و نام خانوادگی کاربر را وارد کنید" %}
												</div>
												<div class="form-group">
													<label for="id_email">پست الکترونیک</label>
													{% render_field update_user_form.email class+="form-control" placeholder="ایمیل کاربر را وارد کنید" required="required" %}
												</div>
												<div class="form-group">
													<label for="id_password">کلمه عبور</label>
													{% render_field update_user_form.password class+="form-control" placeholder="کلمه عبور کاربر را وارد کنید" %}
												</div>
												<div class="form-group">
													<label for="id_phone">تلفن</label>
													{% render_field update_user_form.phone class+="form-control" placeholder="شماره تلفن کاربر را وارد کنید" %}
												</div>
												<div class="form-group">
													<label for="id_address">آدرس</label>
													{% render_field update_user_form.address class+="form-control" placeholder="آدرس کاربر را وارد کنید" %}
												</div>
												<div class="form-group">
													<label for="id_avatar">تصویر پروفایل</label>
													<div class="input-group">
														<div class="custom-file">
															{% render_field update_user_form.avatar class+="custom-file-input" %}
															<label class="custom-file-label" for="id_avatar">Choose file</label>
														</div>
													</div>
												</div>
												<div class="form-group row row-sm">
													<div class="mg-t-20 mg-lg-t-0">
														<label class="ckbox">{% render_field update_user_form.is_active %}<span>فعال بودن</span></label>
													</div>
												</div>
											</div> {% endcomment %}
											<div class="card-body">
												<div class="form-group">
													<label for="id_nick_name">نام نمایشی</label>
													<input type="text" name="nick_name" maxlength="128" class="form-control" placeholder="نام  نمایشی کاربر را وارد کنید" {% if simple_user.nick_name %} value="{{ simple_user.nick_name }}" {% endif %} id="id_nick_name">
												</div>
												<div class="form-group">
													<label for="id_full_name">نام و نام خانوادگی</label>
													<input type="text" name="full_name" maxlength="128" class="form-control" placeholder="نام و نام خانوادگی کاربر را وارد کنید" {% if simple_user.full_name %} value="{{ simple_user.full_name }}" {% endif %} id="id_full_name">
												</div>
												<div class="form-group">
													<label for="id_email">پست الکترونیک</label>
													<input type="email" name="email" maxlength="254" class="form-control" required placeholder="ایمیل کاربر را وارد کنید" {% if simple_user.email %} value="{{ simple_user.email }}"{% endif %} id="id_email">
												</div>
												<div class="form-group">
													<label for="id_password">کلمه عبور</label>
													<input type="password" name="password" class="form-control" placeholder="کلمه عبور کاربر را وارد کنید" id="id_password">
												</div>
												<div class="form-group">
													<label for="id_phone">تلفن</label>
													<input type="text" name="phone" maxlength="13" class="form-control" placeholder="شماره تلفن کاربر را وارد کنید" {% if simple_user.phone %} value="{{ simple_user.phone }}" {% endif %} id="id_phone">
												</div>
												<div class="form-group">
													<label for="id_address">آدرس</label>
													<textarea name="address" cols="40" rows="2" class="form-control" placeholder="آدرس کاربر را وارد کنید" id="id_address">{% if simple_user.address %} {{ simple_user.address }} {% endif %}</textarea>
												</div>
												<div class="form-group">
													<label for="id_avatar">تصویر پروفایل</label>
													<div class="input-group">
														<div class="custom-file">
															<input type="file" name="avatar" accept="image/*" class="custom-file-input" id="id_avatar">
															<label class="custom-file-label" for="id_avatar">Choose file</label>
														</div>
													</div>
												</div>
												<div class="form-group row row-sm">
													<div class="mg-t-20 mg-lg-t-0">
														<label for="id_is_active" class="ckbox"><input {% if simple_user.is_active %}checked{% endif %} type="checkbox" name="is_active" id="id_is_active"><span>فعال بودن</span></label>
													</div>
												</div>
											</div>
											<!-- /.card-body -->

											<div class="card-footer">
												<button type="submit" class="btn btn-primary">ویرایش</button>
											</div>
										</form>
									</div>
								</div>
								<!-- /.modal-content -->
							</div>
							<!-- /.modal-dialog -->
						</div>
						<!-- /.modal -->

					{% endfor %}

				</table>

			</div>
		</div>
	</div>
</div>
{% endblock main-inner-content %}